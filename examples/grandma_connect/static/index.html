<!DOCTYPE html>
<style>
    #image {
        display: block;
        margin: 0 auto;
        position: relative;
    }

    #ball {
        width: 50px;
        height: 50px;
        background-color: red;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        cursor: pointer;
    }
</style>
</head>

<body>
    <img id="image" src="scene_drawing.png" alt="Trackable Image">
    <div id="ball"></div>
    <script>
        const image = document.getElementById('image');
        const ball = document.getElementById('ball');
        let ws;
        let lastSend = 0;
        const reconnectInterval = 1000; // Reconnect interval in ms

        function connectWebSocket() {
            ws = new WebSocket('ws://localhost:8000/ws'); // Replace with your WebSocket server address

            ws.onopen = () => {
                console.log('Connected to WebSocket server');
            };

            ws.onclose = () => {
                console.log('Disconnected from WebSocket server');
                setTimeout(connectWebSocket, reconnectInterval);
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
                ws.close();
            };
        }

        connectWebSocket();

        let isDragging = false;

        ball.addEventListener('mousedown', (event) => {
            isDragging = true;
        });

        document.addEventListener('mousemove', (event) => {
            if (isDragging) {
                const rect = image.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                const x = event.clientX - centerX;
                const y = centerY - event.clientY;

                ball.style.left = `${event.clientX}px`;
                ball.style.top = `${event.clientY}px`;

                const now = performance.now();
                if (ws.readyState === WebSocket.OPEN && now - lastSend >= 33.33) { // ~30 FPS
                    ws.send(JSON.stringify({ x: x, y: y }));
                    lastSend = now;
                }
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
        });
    </script>
</body>

</html>